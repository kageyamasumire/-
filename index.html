<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ラボ用 計算アプリ（PWA 完全版 v0.22）</title>

<!-- PWA manifest / theme -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2f54eb">

<!-- iOS: label & icon & fullscreen -->
<meta name="apple-mobile-web-app-title" content="ラボ用 計算アプリ">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
  :root{--main:#2f54eb;}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;margin:0;background:#fff;color:#222}
  header{background:var(--main);color:#fff;padding:16px 20px}
  header h1{margin:0;font-size:18px;letter-spacing:.5px}
  header .sub{opacity:.9;font-size:12px;margin-top:4px}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .badge{display:inline-block;background:#eef;border:1px solid rgba(0,0,0,.06);padding:4px 8px;border-radius:8px;font-size:12px;margin-right:8px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
  .tabs button{border:1px solid #dfe3f0;background:#f7f9ff;color:#222;padding:8px 10px;border-radius:8px;cursor:pointer}
  .tabs button.active{background:var(--main);border-color:var(--main);color:#fff}
  section.tab{display:none}
  section.tab.active{display:block;animation:fade .15s ease}
  @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
  .card{border:1px solid #e6e9f5;border-radius:12px;padding:14px;margin:10px 0}
  .muted{color:#555}
  code{background:#f5f7ff;border:1px solid #e6e9f5;padding:1px 4px;border-radius:6px}
  footer{padding:24px 20px;color:#666}
</style>
</head>
<body>
<header>
  <h1>ラボ用 計算アプリ <span class="badge">PWA</span> <span class="badge">v0.22</span></h1>
  <div class="sub">オフライン対応 / ホーム画面追加OK（iOS/Android）</div>
</header>

<div class="wrap">
  <div class="tabs">
    <button class="tab-btn active" data-tab="home">ホーム</button>
    <button class="tab-btn" data-tab="cells">細胞数/生存率</button>
    <button class="tab-btn" data-tab="agarose">アガロースゲル</button>
    <button class="tab-btn" data-tab="sterile">滅菌方法</button>
    <button class="tab-btn" data-tab="reagents">試薬調整</button>
  </div>

  <section id="tab-home" class="tab active">
    <div class="card">
      <b>ようこそ！</b><br>
      これは <b>完全版PWAシェル</b> です。既存のアプリ本体をこの枠にコピペすれば、<u>即</u> PWA 化したアプリになります。<br>
      <ul>
        <li>オフラインで動作（このページは SW でキャッシュ）</li>
        <li>ホーム画面に追加で全画面起動</li>
        <li><code>?tab=cells</code> などのショートカット起動対応</li>
      </ul>
      <div id="pwa-status" class="muted">PWA準備中…</div>
    </div>
    <div class="card">
      <b>マージ手順（既存アプリと合体）</b>
      <ol>
        <li>この <code>index.html</code> の各タブ（下の4つ）に、あなたの既存コンテンツを貼り付ける</li>
        <li><code>manifest.webmanifest</code> と <code>sw.js</code> はこのままでOK（必要なら <code>CACHE</code> を増分）</li>
        <li>GitHub Pages にデプロイ → リロード → オフラインテスト</li>
      </ol>
    </div>
  </section>

  <section id="tab-cells" class="tab">
    <div class="card"><b>細胞数/生存率</b><div class="muted">ここに既存の「細胞数/生存率」シートを貼り付けてください。</div></div>
  </section>

  <section id="tab-agarose" class="tab">
    <div class="card"><b>アガロースゲル</b><div class="muted">ここに既存の「アガロースゲル」シートを貼り付けてください。</div></div>
  </section>

  <section id="tab-sterile" class="tab">
    <div class="card"><b>滅菌方法（セレクタで表示）</b><div class="muted">ここに既存の「滅菌方法」UIを貼り付けてください。</div></div>
  </section>

  <section id="tab-reagents" class="tab">
    <div class="card"><b>細胞培養の試薬調整</b><div class="muted">ここに既存の「試薬調整」テーブル/計算UIを貼り付けてください。</div></div>
  </section>
</div>

<footer class="wrap">
  <div class="muted">© ラボ用 計算アプリ – PWA 完全版テンプレート</div>
</footer>

<script>
// タブ切替
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section.tab').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    const id = 'tab-' + btn.dataset.tab;
    const sec = document.getElementById(id);
    if (sec) sec.classList.add('active');
    history.replaceState(null,'', location.pathname + '?tab=' + btn.dataset.tab);
  });
});

// 起動時に ?tab=xxx で開く
(function openTabFromQuery() {
  const p = new URLSearchParams(location.search);
  const t = p.get('tab');
  if (!t) return;
  const btn = document.querySelector(`.tab-btn[data-tab="${t}"]`);
  if (btn) btn.click();
})();

// Service Worker 登録
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js', { scope: './' })
    .then(reg => {
      document.getElementById('pwa-status').textContent = 'PWA有効：オフライン対応・ホーム画面追加OK';
    })
    .catch(err => {
      document.getElementById('pwa-status').textContent = 'PWA登録エラー: ' + err;
    });
} else {
  const el = document.getElementById('pwa-status');
  if (el) el.textContent = 'このブラウザはService Worker非対応です';
}
</script>
</body>
</html>
